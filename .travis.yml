sudo: required

dist: trusty

env:
  - VERSION=2.6
  - VERSION=3.0
  - VERSION=3.2
  - VERSION=3.4

before_install:
  - sudo apt-get -y purge docker-engine
  - bash <(curl -fsSL https://get.docker.com/)
  - docker version
  - docker network create --driver=bridge --subnet=192.168.0.0/16 --opt="com.docker.network.driver.mtu=1450" --opt="com.docker.network.bridge.name=redd0" nanobox
  - ifconfig
  - echo building $VERSION
  - docker pull nanobox/mongodb:$VERSION || (docker pull nanobox/mongodb:${VERSION}-beta; docker tag nanobox/mongodb:${VERSION}-beta nanobox/mongodb:${VERSION})

script: sudo stdbuf -oL test/run_all.sh $VERSION